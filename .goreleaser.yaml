# This is an example .goreleaser.yml file with some sensible defaults.
# Make sure to check the documentation at https://goreleaser.com
before:
  hooks:
    # You may remove this if you don't use go modules.
    - go mod tidy
    # you may remove this if you don't need go generate
    - go generate ./...
builds:
  - env:
      - CGO_ENABLED=0
    goos:
      - linux
      - windows
      - darwin
    goarch:
      - "386"
      - amd64
      - arm
      - arm64
#      - ppc64
    goarm:
      - "7"
    ignore:
      - goos: windows
        goarch: arm
    mod_timestamp: "{{ .CommitTimestamp }}"
    flags:
      - -trimpath
    ldflags:
      - -s -w -X main.version={{.Version}} -X main.commit={{.Commit}} -X main.date={{ .CommitDate }} -X main.builtBy=goreleaser -X main.treeState={{ .IsGitDirty }}


metadata:
  mod_timestamp: "{{ .CommitTimestamp }}"

changelog:
  sort: asc
  use: github
  filters:
    exclude:
      - "^test:"
#      - "^chore"
      - "merge conflict"
      - Merge pull request
      - Merge remote-tracking branch
      - Merge branch
      - go mod tidy
  groups:
    - title: Dependency updates # ä¾èµ–æ›´æ–°
      regexp: '^.*?(feat|fix)\(deps\)!?:.+$'
      order: 300
    - title: "Features" # æ–°åŠŸèƒ½ï¼š ä¾‹å¦‚ï¼Œæ–°åŠŸèƒ½ã€æ–°é¡µé¢ã€æ–°ç»„ä»¶ç­‰
      regexp: '^.*?feat(\([[:word:]]+\))??!?:.+$'
      order: 100
    - title: "Refactor" # é‡æž„ï¼š ä¾‹å¦‚ï¼Œé‡æž„ä»£ç ã€æ ¼å¼åŒ–ä»£ç ã€ç§»åŠ¨æ–‡ä»¶ç­‰
      regexp: '^.*?refactor(\([[:word:]]+\))??!?:.+$'
      order: 150
    - title: "Security updates" # å®‰å…¨æ›´æ–°ï¼š ä¾‹å¦‚ï¼Œæ·»åŠ å®‰å…¨å¤´ã€æ›´æ–° .gitignoreã€æ›´æ–° .gitattributes ç­‰
      regexp: '^.*?sec(\([[:word:]]+\))??!?:.+$'
      order: 150
    - title: ":bug:ðŸ› Bug fixes" # ä¿®å¤é”™è¯¯ï¼š ä¾‹å¦‚ï¼Œä¿®å¤ bugã€ä¿®å¤æ‹¼å†™é”™è¯¯ç­‰
      regexp: '^.*?fix(\([[:word:]]+\))??!?:.+$'
      order: 200
    - title: ":zap: Perf" # ä¼˜åŒ–ç›¸å…³ï¼Œæ¯”å¦‚æå‡æ€§èƒ½ã€ä½“éªŒã€‚
      regexp: '^.*?perf(\([[:word:]]+\))??!?:.+$'
      order: 300
    - title: "Chore" # æ‚åŠ¡ï¼šé€šå¸¸ç”¨äºŽæè¿°å…¶ä»–ä¸å±žäºŽæ–°åŠŸèƒ½ã€ä¿®å¤é”™è¯¯æˆ–é‡æž„ä»£ç çš„æäº¤ã€‚ ä¾‹å¦‚ï¼Œæ›´æ–°æ–‡æ¡£ã€æ¸…ç†ä»£ç ã€æ›´æ–°ä¾èµ–é¡¹ã€åˆ é™¤æ–‡ä»¶ç­‰
      regexp: '^.*?chore(\([[:word:]]+\))??!?:.+$'
      order: 300
    - title: "Documentation updates"
      regexp: ^.*?doc(\([[:word:]]+\))??!?:.+$
      order: 400
    - title: "Build process updates"
      regexp: ^.*?build(\([[:word:]]+\))??!?:.+$
      order: 400
    - title: Other work
      order: 9999


archives:
  - name_template: >-
      {{- .ProjectName }}_
      {{- title .Os }}_ 
      {{- if eq .Arch "386" }}i386
      {{- else }}{{ .Arch }}{{ end }}
      {{- if .Arm }}v{{ .Arm }}{{ end -}}
    format_overrides:
      - goos: windows
        format: zip
    builds_info:
      group: root
      owner: root
    files:
      - README.md

checksum:
  name_template: 'checksums.txt'
snapshot:
  name_template: "{{ incpatch .Version }}-next"

# The lines beneath this are called `modelines`. See `:help modeline`
# Feel free to remove those if you don't want/use them.
# yaml-language-server: $schema=https://goreleaser.com/static/schema.json
# vim: set ts=2 sw=2 tw=0 fo=cnqoj
